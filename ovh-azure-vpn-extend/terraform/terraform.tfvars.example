# terraform.tfvars.example
# Extension du VPN Gateway existant pour OVHcloud RBX/SBG

environment = "prod"

###############################
# Infrastructure Azure Existante
# (À récupérer depuis votre déploiement précédent)
###############################

# Resource Group créé précédemment
existing_resource_group_name = "rg-dev-onprem"  # CHANGEME: votre RG du package précédent

# VPN Gateway créé précédemment
existing_vpn_gateway_name = "vpngw-dev-azure"  # CHANGEME: nom de votre VPN Gateway

# VNet existant
existing_vnet_name = "vnet-dev-azure"  # CHANGEME: nom de votre VNet
existing_vnet_cidr = "10.1.0.0/16"     # CHANGEME: CIDR de votre VNet

# Route table existante (laisser vide si pas de route table)
existing_route_table_name = ""  # Optionnel

###############################
# BGP Configuration Azure
# ⚠️ IMPORTANT: Vérifier que BGP est activé sur votre VPN Gateway
# Commande: az network vnet-gateway show --name <nom> --resource-group <rg> --query "bgpSettings"
###############################

azure_bgp_asn = 65515  # CHANGEME si vous avez un ASN différent

# Nouvelles adresses APIPA pour tunnels OVH
# ⚠️ Doivent être différentes de celles utilisées avec StrongSwan
azure_bgp_apipa_primary   = "169.254.30.1"  # Nouvelle plage pour OVH
azure_bgp_apipa_secondary = "169.254.31.1"  # Pour Active-Active si applicable

###############################
# OVHcloud RBX (Primary)
###############################

ovh_rbx_public_ip    = "X.X.X.X"                    # CHANGEME: IP publique FortiGate RBX
ovh_rbx_network_cidr = "192.168.10.0/24"            # Réseau derrière RBX
rbx_bgp_asn          = 65001                         # ASN privé RBX
rbx_bgp_peer_ip      = "169.254.30.2"               # IP BGP peer FortiGate RBX (même subnet que azure_bgp_apipa_primary)
ipsec_psk_rbx        = "CHANGEME_STRONG_PSK_RBX"    # Générer avec: openssl rand -base64 32

# BGP Priority pour RBX (route primaire)
rbx_local_preference = 200              # Plus élevé = préféré
rbx_as_path_prepend  = 0                # Pas de prepend = route courte

###############################
# OVHcloud SBG (Backup)
###############################

ovh_sbg_public_ip    = "Y.Y.Y.Y"                    # CHANGEME: IP publique FortiGate SBG
ovh_sbg_network_cidr = "192.168.20.0/24"            # Réseau derrière SBG
sbg_bgp_asn          = 65002                         # ASN privé SBG
sbg_bgp_peer_ip      = "169.254.31.2"               # IP BGP peer FortiGate SBG (même subnet que azure_bgp_apipa_secondary)
ipsec_psk_sbg        = "CHANGEME_STRONG_PSK_SBG"    # Générer avec: openssl rand -base64 32

# BGP Priority pour SBG (route backup)
sbg_local_preference = 100              # Plus bas = moins préféré
sbg_as_path_prepend  = 3                # Prepend ASN 3 fois = route longue

###############################
# FortiGate Access
###############################

fortigate_admin_username = "admin"
fortigate_admin_password = "CHANGEME_FORTIGATE_PASSWORD"  # Mot de passe FortiGate

# IPs de management des FortiGates
fortigate_rbx_mgmt_ip = "Z.Z.Z.Z"       # CHANGEME: IP management FortiGate RBX
fortigate_sbg_mgmt_ip = "W.W.W.W"       # CHANGEME: IP management FortiGate SBG

###############################
# Notes importantes
###############################

# 1. Ce package ÉTEND votre VPN Gateway existant, il ne le recrée pas
# 2. BGP DOIT être activé sur votre VPN Gateway existant
#    Si BGP n'est pas activé, vous devez soit:
#    a) Recréer le gateway avec BGP (downtime)
#    b) Activer BGP via Azure CLI (peut nécessiter recréation)
#
# 3. Les adresses APIPA (169.254.x.x) doivent être dans des ranges /30 distincts:
#    - StrongSwan (existant): 169.254.21.x/30, 169.254.22.x/30
#    - OVH RBX (nouveau):     169.254.30.x/30
#    - OVH SBG (nouveau):     169.254.31.x/30
#
# 4. Génération de PSK forts: openssl rand -base64 32
#
# 5. Après déploiement Terraform, configurer les FortiGates avec Ansible
